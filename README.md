# NuaaSwap - å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€

è¿™æ˜¯å—äº¬èˆªç©ºèˆªå¤©å¤§å­¦åŒºå—é“¾è¯¾ç¨‹çš„æœŸæœ«è€ƒè¯•é¡¹ç›®ï¼Œå®ç°äº†ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

NuaaSwap æ˜¯ä¸€ä¸ªåŸºäºè‡ªåŠ¨åšå¸‚å•†ï¼ˆAMMï¼‰æ¨¡å‹çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œé‡‡ç”¨æ’å®šä¹˜ç§¯å…¬å¼ï¼ˆx * y = kï¼‰å®ç°ä»£å¸äº¤æ¢ã€‚è¯¥é¡¹ç›®åŒ…å«å®Œæ•´çš„æ™ºèƒ½åˆçº¦å®ç°ã€æµ‹è¯•å¥—ä»¶å’Œéƒ¨ç½²è„šæœ¬ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **æµåŠ¨æ€§ç®¡ç†**ï¼šæ·»åŠ å’Œç§»é™¤æµåŠ¨æ€§æ± 
- **ä»£å¸äº¤æ¢**ï¼šåŸºäº AMM ç®—æ³•çš„è‡ªåŠ¨ä»£å¸äº¤æ¢
- **è´¹ç”¨æœºåˆ¶**ï¼š0.3% äº¤æ˜“è´¹ç”¨ + å¯é…ç½®åè®®è´¹ç”¨
- **å®‰å…¨ä¿æŠ¤**ï¼šé‡å…¥æ”»å‡»é˜²æŠ¤ã€æ»‘ç‚¹ä¿æŠ¤ã€æƒé™ç®¡ç†
- **ç®¡ç†åŠŸèƒ½**ï¼šåˆçº¦æš‚åœ/æ¢å¤ã€è´¹ç”¨é…ç½®

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
nuaa_swap/
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ nuaa_swap.sol      # æ ¸å¿ƒäº¤æ¢åˆçº¦
â”‚   â”œâ”€â”€ corn_a.sol         # æµ‹è¯•ä»£å¸ A
â”‚   â””â”€â”€ corn_b.sol         # æµ‹è¯•ä»£å¸ B
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ TestNuaaSwap.sol         # è‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ ManualTestNuaaSwap.sol   # æ‰‹åŠ¨äº¤äº’æµ‹è¯•
â”‚   â””â”€â”€ README_Test.md       # è¯¦ç»†æµ‹è¯•æŒ‡å—
â”œâ”€â”€ artifacts/             # ç¼–è¯‘äº§ç‰©
â””â”€â”€ .deps/                 # ä¾èµ–ç®¡ç†
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Solidity**: ^0.8.20
- **å¼€å‘ç¯å¢ƒ**: Remix IDEï¼ˆæ¨èï¼‰æˆ– Hardhat
- **ç½‘ç»œ**: ä»¥å¤ªåŠæµ‹è¯•ç½‘æˆ–æœ¬åœ°ç½‘ç»œ

### éƒ¨ç½²æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone [<é¡¹ç›®åœ°å€>](https://github.com/lifeprompter/nuaa_swap)
cd nuaa_swap
```

2. **åœ¨ Remix IDE ä¸­æ‰“å¼€**
   - è®¿é—® https://remix.ethereum.org/
   - å¯¼å…¥é¡¹ç›®æ–‡ä»¶å¤¹
   - ç¡®ä¿ Solidity ç¼–è¯‘å™¨ç‰ˆæœ¬è®¾ç½®ä¸º 0.8.20

3. **ç¼–è¯‘åˆçº¦**
   - ç¼–è¯‘ `contracts/corn_a.sol`
   - ç¼–è¯‘ `contracts/corn_b.sol`  
   - ç¼–è¯‘ `contracts/nuaa_swap.sol`

4. **éƒ¨ç½²åˆçº¦**
   ```solidity
   // 1. éƒ¨ç½² TokenA
   TokenA tokenA = new TokenA();
   
   // 2. éƒ¨ç½² TokenB  
   TokenB tokenB = new TokenB();
   
   // 3. éƒ¨ç½² NuaaSwapï¼ˆä¼ å…¥ä¸¤ä¸ªä»£å¸åœ°å€ï¼‰
   NuaaSwap swap = new NuaaSwap(address(tokenA), address(tokenB));
   ```

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### åŸºæœ¬æ“ä½œæµç¨‹

#### 1. æˆæƒä»£å¸
åœ¨è¿›è¡Œä»»ä½•æ“ä½œå‰ï¼Œéœ€è¦æˆæƒåˆçº¦ä½¿ç”¨æ‚¨çš„ä»£å¸ï¼š
```solidity
tokenA.approve(swapAddress, amount);
tokenB.approve(swapAddress, amount);
```

#### 2. æ·»åŠ æµåŠ¨æ€§
```solidity
// æ·»åŠ  1000 TokenA å’Œ 2000 TokenB çš„æµåŠ¨æ€§
swap.add_liquidity(1000 * 10**18, 2000 * 10**18);
```

#### 3. è¿›è¡Œä»£å¸äº¤æ¢
```solidity
// å°† 100 TokenA äº¤æ¢ä¸º TokenBï¼Œæœ€å°è¾“å‡ºé‡ä¸º 190ï¼Œæˆªæ­¢æ—¶é—´ä¸ºå½“å‰æ—¶é—´+300ç§’
swap.swap(
    address(tokenA),           // è¾“å…¥ä»£å¸
    100 * 10**18,             // è¾“å…¥æ•°é‡
    190 * 10**18,             // æœ€å°è¾“å‡ºæ•°é‡ï¼ˆæ»‘ç‚¹ä¿æŠ¤ï¼‰
    block.timestamp + 300     // äº¤æ˜“æˆªæ­¢æ—¶é—´
);
```

#### 4. ç§»é™¤æµåŠ¨æ€§
```solidity
// ç§»é™¤æŒ‡å®šæ•°é‡çš„æµåŠ¨æ€§ä»½é¢
swap.remove_liquidity(shares);
```

### ç®¡ç†å‘˜åŠŸèƒ½

#### è®¾ç½®åè®®è´¹ç”¨
```solidity
// è®¾ç½® 0.5% çš„åè®®è´¹ç”¨ï¼ˆ50 åŸºç‚¹ï¼‰
swap.setProtocolFee(50);
```

#### è®¾ç½®è´¹ç”¨æ¥æ”¶åœ°å€
```solidity
swap.setFeeTo(feeReceiverAddress);
```

#### æš‚åœ/æ¢å¤åˆçº¦
```solidity
swap.pause();    // æš‚åœåˆçº¦
swap.unpause();  // æ¢å¤åˆçº¦
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

é¡¹ç›®æä¾›äº†ä¸¤ç§æµ‹è¯•æ–¹å¼ï¼š

### è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆæ¨èï¼‰
ä½¿ç”¨ `TestNuaaSwap.sol` è¿›è¡Œå®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼š
```bash
# åœ¨ Remix ä¸­
1. æ‰“å¼€ "Solidity Unit Testing" æ’ä»¶
2. é€‰æ‹© tests/TestNuaaSwap.sol
3. ç‚¹å‡» "Run" æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
```

### æ‰‹åŠ¨äº¤äº’æµ‹è¯•
ä½¿ç”¨ `ManualTestNuaaSwap.sol` è¿›è¡Œé€æ­¥æµ‹è¯•ï¼š
è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ [æµ‹è¯•è¯´æ˜æ–‡æ¡£](tests/README_Test.md)

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### AMM ç®—æ³•å®ç°

```solidity
// æ’å®šä¹˜ç§¯å…¬å¼ï¼šx * y = k
// äº¤æ¢è®¡ç®—ï¼ˆå« 0.3% æ‰‹ç»­è´¹ï¼‰
uint amountInWithFee = amountIn * 997;
uint numerator = amountInWithFee * reserveOut;
uint denominator = (reserveIn * 1000) + amountInWithFee;
uint amountOut = numerator / denominator;
```

### æµåŠ¨æ€§è®¡ç®—

```solidity
// åˆæ¬¡æ·»åŠ æµåŠ¨æ€§
if (totalShares == 0) {
    shares = sqrt(amount0 * amount1);
}
// åç»­æ·»åŠ æµåŠ¨æ€§
else {
    shares = min(
        (amount0 * totalShares) / reserve0,
        (amount1 * totalShares) / reserve1
    );
}
```

### åˆçº¦ç‰¹æ€§

- **é‡å…¥ä¿æŠ¤**: ä½¿ç”¨ OpenZeppelin çš„ `ReentrancyGuard`
- **æƒé™ç®¡ç†**: ç»§æ‰¿ `Ownable` å®ç°ç®¡ç†å‘˜åŠŸèƒ½
- **æš‚åœæœºåˆ¶**: é›†æˆ `Pausable` ç”¨äºç´§æ€¥æƒ…å†µ
- **æ»‘ç‚¹ä¿æŠ¤**: äº¤æ¢æ—¶æ£€æŸ¥æœ€å°è¾“å‡ºé‡
- **æ—¶é—´é”**: äº¤æ˜“æˆªæ­¢æ—¶é—´éªŒè¯

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### å·²å®ç°çš„å®‰å…¨æªæ–½

1. **é‡å…¥æ”»å‡»é˜²æŠ¤**: ä½¿ç”¨ `nonReentrant` ä¿®é¥°ç¬¦
2. **æ•´æ•°æº¢å‡ºä¿æŠ¤**: Solidity 0.8+ å†…ç½®æº¢å‡ºæ£€æŸ¥
3. **æƒé™æ§åˆ¶**: ç®¡ç†å‘˜åŠŸèƒ½ä»…é™åˆçº¦æ‰€æœ‰è€…
4. **æ»‘ç‚¹ä¿æŠ¤**: ç”¨æˆ·å¯è®¾ç½®æœ€å°è¾“å‡ºé‡
5. **æ—¶é—´éªŒè¯**: é˜²æ­¢è¿‡æœŸäº¤æ˜“æ‰§è¡Œ

### é£é™©æç¤º

- **æ— å¸¸æŸå¤±**: æµåŠ¨æ€§æä¾›è€…é¢ä¸´çš„å›ºæœ‰é£é™©
- **æ™ºèƒ½åˆçº¦é£é™©**: ä»£ç å¯èƒ½å­˜åœ¨æœªçŸ¥æ¼æ´
- **ä»·æ ¼æ“çºµ**: å°æ± å­å®¹æ˜“å—åˆ°ä»·æ ¼æ“çºµ

## ğŸ“Š åˆçº¦ä¿¡æ¯

| å‚æ•° | è¯´æ˜ |
|------|------|
| äº¤æ˜“è´¹ç”¨ | 0.3% (å›ºå®š) |
| åè®®è´¹ç”¨ | 0-10% (å¯é…ç½®) |
| æœ€å°æµåŠ¨æ€§ | 1000 wei |
| Gas ä¼˜åŒ– | ä½¿ç”¨ `immutable` å’Œ `packed` å­˜å‚¨ |


## ğŸ“š ç›¸å…³èµ„æº

- [Uniswap V2 ç™½çš®ä¹¦](https://uniswap.org/whitepaper.pdf)
- [OpenZeppelin åˆçº¦åº“](https://openzeppelin.com/contracts/)
- [Solidity å®˜æ–¹æ–‡æ¡£](https://docs.soliditylang.org/)

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ‘¥ å›¢é˜Ÿä¿¡æ¯

**ç”± [lifeprompter](https://github.com/lifeprompter) ç‹¬ç«‹å®Œæˆæ’°å†™**

---

*âš ï¸ å…è´£å£°æ˜ï¼šæœ¬é¡¹ç›®ä»…ç”¨äºæ•™è‚²ç›®çš„ï¼Œä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ä½¿ç”¨å‰è¯·è¿›è¡Œå…¨é¢çš„å®‰å…¨å®¡è®¡ã€‚*
